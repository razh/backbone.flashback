!function(a,b){"use strict";function c(a){this.target=a||null,this.state=a?a.toJSON():{}}function d(){this.current=null,this.undoStack=[],this.redoStack=[],this.previous=null}return c.prototype={restore:function(){this.target&&this.target.set(this.state)},reference:function(a){if(a&&!(this.target instanceof b.Collection)){var c=a.get(this.state.id);c&&(this.target=c)}}},b.Flashback=d,d.Memento=c,d.prototype={save:function(a){this.store(this.snapshot(a))},store:function(a){this.current&&this.undoStack.push(this.current),this.current=a,this.redoStack=[]},snapshot:function(b){return a.isArray(b)?b.map(function(a){return new c(a)}):[new c(b)]},begin:function(b){a.isEmpty(b)||(this.previous=this.snapshot(b))},end:function(){if(this.previous){var b=this.previous.filter(function(b){return!a.isEqual(b.state,b.target.toJSON())}),c=b.map(function(a){return a.target});c.length&&(this.current||(this.current=[]),this.current=this.current.concat(b),this.save(c))}},timeTravel:function(a,c){if(a&&c&&a.length){this.current&&c.push(this.current),this.current=a.pop();var d=this;return this.current.forEach(function(a){a.restore(),a.target instanceof b.Collection&&d.reference(a.target)}),this}},undo:function(){return this.timeTravel(this.undoStack,this.redoStack)},redo:function(){return this.timeTravel(this.redoStack,this.undoStack)},canUndo:function(){return this.undoStack.length},canRedo:function(){return this.redoStack.length},clear:function(){this.undoStack=[],this.redoStack=[]},reference:function(a){this.undoStack.concat(this.redoStack).forEach(function(b){b.forEach(function(b){b.reference(a)})})}},d}(_,Backbone);
/*
//@ sourceMappingURL=flashback.min.map
*/